# Примерный протокол обмена сообщениями #

По возможности следует использовать протокол UDP. Для удобства работы предусмотрена "библиотека" `dconnect.h`.

Более подробное описание всех функций и структур есть в заголовочном файле.




## Структура пакетов ##

Для удобства в библиотеке имеются следующие типы:

* `HR_ADDRESS`. Содержит IP-адрес и порт в читаемом виде

* `UPACK_HEAD`. "Заголовок" любого пересылаемого пакета. Все пересылаемые данные (которые передаются в поле `data`) должны удовлетворять этому заголовку (то есть указатель на эти данные можно корректно привести к типу `UPACK_HEAD*`)

У всех пакетов есть *type*, *stamp* и *data* (так же называются поля структуры `UPACK_HEAD`)

У функций для отправки пакетов есть параметр *repeats* &mdash; число повторных отправок за один вызов этой функции. Лучше использовать стандартные константы (есть в заголовочном файле).




## Соединение ##

#### `d_client_connect()` ####

Связывает клиент и сервер, обновляя данные друг о друге на каждой стороне.

1. Клиент посылает пакет с type = `DP_CONNECT` и stamp = `DP_S_ASK`. Отправка происходит столько раз, сколько определено в одной из локальных констант функции `d_client_connect()`
2. Если сервер разрешает клиенту присоединиться, он отправляет в ответ такой же пакет, но с stamp = `DP_S_SUCCESS`; repeats = `1`.
3. Если сервер не разрешает клиенту присоединиться, он отправляет в ответ такой же пакет, но с stamp = `DP_S_ERROR`; repeats = `1`.




## Обновление игрового поля ##

#### `d_server_send()` ####

TODO




## Передача команд от игрока ##

#### `d_client_send()` ####

TODO
